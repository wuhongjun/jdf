/* jdf-1.0.0/ contrast.js Date:2015-06-01 17:02:42 */
define("jdf/1.0.0/unit/contrast/1.0.0/contrast.js",["jdf/1.0.0/unit/trimPath/1.0.0/trimPath.js","jdf/1.0.0/unit/lib/1.0.0/lib.js","jdf/1.0.0/unit/globalReco/1.0.0/globalReco.js","http://misc.360buyimg.com/contrast/skin/2012/pop_compare.css?v=20140123"],function(require){require("jdf/1.0.0/unit/trimPath/1.0.0/trimPath.js");require("jdf/1.0.0/unit/lib/1.0.0/lib.js");var e=require("jdf/1.0.0/unit/globalReco/1.0.0/globalReco.js");require("http://misc.360buyimg.com/contrast/skin/2012/pop_compare.css?v=20140123");var g=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");for(;c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",d[0];);return b>4?b:a}();!function(a){a.fn.imgScroll=function(b,c){var d={data:[],template:null,evtType:"click",visible:1,direction:"x",next:"#next",prev:"#prev",disableClass:"disabled",disableClassPerfix:!1,speed:300,step:1,loop:!1,showControl:!1,width:null,height:null,navItems:!1,navItmesWrapClass:"scroll-nav-wrap",navItemActivedClass:"current",status:!1,statusWrapSelector:".scroll-status-wrap"};var e=a.extend(d,b);return this.each(function(){var f,b=a(this),d=b.find("ul").eq(0),g=d.children("li"),h=g.length,i=null,j=null,k="string"==typeof e.next?a(e.next):e.next,l="string"==typeof e.prev?a(e.prev):e.prev,m=0,n=e.step,o=e.visible,p=Math.ceil((h-o)/n)+1,q=e.loop,r=e.direction,s=e.evtType,t=e.disableClass,u=e.disableClassPerfix?"prev-"+t:t,v=e.disableClassPerfix?"next-"+t:t,w=e.navItems,x=e.navItmesWrapClass,y=a("."+x).length>0,z=e.navItemActivedClass,A=e.status,B=e.statusWrapSelector,C=a(B).length>0,D=!1,E=!0,F=(h-o)%n===0,G=e.template||'<ul>{for slide in list}<li><a href="${slide.href}" target="_blank"><img src="${slide.src}" alt="${slide.alt}" /></a></li>{/for}</ul>';function H(a){h>o&&!q?(l.addClass(u),k.removeClass(v)):q||k.addClass(v),"left"!==g.eq(0).css("float")&&g.css("float","left"),i=e.width||g.eq(0).outerWidth(),j=e.height||g.eq(0).outerHeight(),b.css({position:"static"==b.css("position")?"relative":b.css("position"),width:"x"==a?i*o:i,height:"x"==a?j:j*o,overflow:"hidden"}),d.css({position:"absolute",width:"x"==a?i*h:i,height:"x"==a?j:j*h,top:0,left:0}),"function"==typeof c&&c.apply(b,[m,p,g.slice(m*n,m*n+o),g.slice(m*n+o-n,m*n+o)])}function I(){h=e.data.length,d=b.find("ul").eq(0),g=d.children("li"),p=Math.ceil((h-o)/n)+1,F=(h-o)%n===0}function J(a){var c={list:a};b.html(G.process(c)),I()}function K(a,s){if(d.is(":animated"))return!1;if(q)E&&s&&(m=p),D&&!s&&(m=-1),a=s?--m:++m;else{if(E&&s||D&&!s)return!1;a=s?--m:++m}f="x"==r?{left:a>=p-1?-(h-o)*i:-a*n*i}:{top:a>=p-1?-(h-o)*j:-a*n*j};function t(){q?(D=o>=h-a*n?!0:!1,E=0>=a?!0:!1):(o>=h-a*n?(k.addClass(v),D=!0):(k.removeClass(v),D=!1),0>=a?(l.addClass(u),E=!0):(l.removeClass(u),E=!1)),(w||A)&&N(a),"function"==typeof c&&c.apply(b,[a,p,g.slice(a*n,a*n+o),g.slice(a*n+o-n,a*n+o)])}e.speed?d.animate(f,e.speed,t):(d.css(f),t())}function L(c,d){var e=y?a("."+c).eq(0):a('<div class="'+c+'"></div>');for(var f=0;p>f;f++)e.append("<em "+(0===f?" class="+d:"")+' title="'+(f+1)+'">'+(f+1)+"</em>");y||b.after(e)}function M(){var c=C?a(B).eq(0):a('<div class="'+B.replace(".","")+'"></div>');c.html("<b>1</b>/"+p),C||b.after(c)}function N(b){w&&a("."+x).find("em").removeClass(z).eq(b).addClass(z),A&&a(B).html("<b>"+(b+1)+"</b>/"+p)}function O(){l.unbind(s).bind(s,function(){K(m,!0)}),k.unbind(s).bind(s,function(){K(m,!1)})}if(e.data.length>0){if(!e.width||!e.height)return!1;J(e.data)}h>o&&o>=n?(H(r),O(),w&&L(x,z),A&&M(B)):(e.showControl?k.add(l).show():k.add(l).hide(),l.addClass(u),k.addClass(v))})}}(jQuery);var h={getPriceNum:function(a,b,c,d){a="string"==typeof a?[a]:a,b=b||$("body"),c=c||"J-p-",$.ajax({url:"http://p.3.cn/prices/mgets?skuIds=J_"+a.join(",J_")+"&type=1",dataType:"jsonp",success:function(a){if(!a&&!a.length)return!1;for(var e=0;e<a.length;e++){var f=a[e].id.replace("J_","");var g=parseFloat(a[e].p,10);b.find("."+c+f).html(g>0?"\uffe5"+a[e].p:"\u6682\u65e0\u62a5\u4ef7"),"function"==typeof d&&d(f,g,a)}}})},TPL:{contrast:'<div id="pop-compare" data-load="false" class="pop-compare'+(pageConfig.wideVersion&&pageConfig.compatible?"":" pop-compare-narrow")+'"><div class="pop-wrap"><p class="pop-compare-tips"></p><div class="pop-inner" data-widget="tabs"><div class="diff-hd"><ul class="tab-btns clearfix"><li class="current" data-widget="tab-item"><a href="javascript:;">\u5bf9\u6bd4\u680f</a></li><li data-widget="tab-item"><a href="javascript:;">\u6700\u8fd1\u6d4f\u89c8</a></li></ul><div class="operate"><a href="javascript:;" class="hide-me">\u9690\u85cf</a></div></div><div class="diff-bd tab-cons"><div class="tab-con" data-widget="tab-content"><div id="diff-items" class="diff-items clearfix"><dl class="item-empty"><dt>1</dt><dd>\u60a8\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u6dfb\u52a0</dd></dl><dl class="item-empty"><dt>2</dt><dd>\u60a8\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u6dfb\u52a0</dd></dl><dl class="item-empty"><dt>3</dt><dd>\u60a8\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u6dfb\u52a0</dd></dl><dl class="item-empty"><dt>4</dt><dd>\u60a8\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u6dfb\u52a0</dd></dl></div><div class="diff-operate"><a target="_blank" id="goto-contrast" href="#none" class="btn-compare-b">\u5bf9\u6bd4</a><a class="del-items">\u6e05\u7a7a\u5bf9\u6bd4\u680f</a></div></div><div class="tab-con" style="display:none;" data-widget="tab-content"><div class="scroll-item clearfix"><span id="sc-prev" class="scroll-btn sb-prev">&lt;</span><span id="sc-next" class="scroll-btn sb-next">&gt;</span><div class="scroll-con clearfix"><ul id="scroll-con-inner"><p class="scroll-loading ac">\u8f7d\u5165\u4e2d...</p></ul></div></div></div></div></div></div></div>',item:'<dl class="hasItem" id="cmp_item_${skuid}" fore="${ind}">  <dt>      <a target="_blank" href="${url}"><img src="${imagePath}" width="50" height="50"></a>  </dt>  <dd>      <a target="_blank" class="diff-item-name" href="${url}">${decodeURIComponent(name)}</a>      <span class="p-price"><strong class="J-p-${skuid}"></strong><a class="del-comp-item" skuid="${skuid}">\u5220\u9664</a></span>  </dd></dl>',recentItem:'<li id="rec_item_${sku}"><div class="rec_item_wrap">  <div class="dt">      <a target="_blank" href="${url}"><img src="${img}" width="50" height="50"></a>  </div>  <div class="dd">      <a target="_blank" href="${url}" class="diff-item-name">${decodeURIComponent(t)}</a>      <div class="btns clb">          <span class="p-price"><strong class="J-p-${sku}"></strong></span>          <a id="recent_${sku}" data-recent="true" skuid="${sku}" class="btn-compare btn-compare-s"><span>\u5bf9\u6bd4</span></a>      </div>  </div></div></li>'},init:function(a,b,c){return this.cookieName=b||"_contrast",this.bindEvent("cmpBtn"),this.showPopWin(c||null),this.bindEvent("showWin"),this.btnStyle(null,"set"),this.domain=pageConfig.FN_getDomain(),this},bindEvent:function(a){var b=$(".btn-compare"),c=$(".del-items"),d=this;return"cmpBtn"==a&&(b.unbind("click").bind("click",function(){var a=$(this).attr("skuid"),b=readCookie(d.cookieName)||"",c=b.split(".").length;4>c?(d.showPopWin(a),"true"==$(this).attr("data-recent")&&d.switchTab(0)):d.hasCookie(a)?("true"==$(this).attr("data-recent")&&d.switchTab(0),d.showPopWin(a)):(d.showPopWin(null),d.setMessage("\u5bf9\u6bd4\u680f\u5df2\u6ee1\uff0c\u60a8\u53ef\u4ee5\u5220\u9664\u4e0d\u9700\u8981\u7684\u680f\u5185\u5546\u54c1\u518d\u7ee7\u7eed\u6dfb\u52a0\u54e6\uff01"))}),d.btnStyle(null,"set")),"delAll"==a&&c.bind("click",function(){d.delContrastItem(null,!0),$("#goto-contrast").attr("href","#none")}),"delHover"==a&&($(".hasItem").hover(function(){$(this).find(".del-comp-item").css("visibility","visible")},function(){$(this).find(".del-comp-item").css("visibility","hidden")}),$("#goto-contrast").click(function(){var a=readCookie(d.cookieName)||"",b=a.split(".");if(b.length<2)return d.setMessage("\u81f3\u5c11\u6709\u4e24\u4ef6\u5546\u54c1\u624d\u80fd\u5bf9\u6bd4\u54e6\uff01"),!1;var c=[0,0,0,0];for(var e=0;e<b.length;e++)c[e]=b[e];$("#goto-contrast").attr("href","http://www.jd.com/compare/"+c.join("-")+".html")})),"hide"==a&&$(".diff-hd .hide-me").bind("click",function(){d.hidePopWin()}),this},switchTab:function(a){$(".diff-hd li").eq(a).trigger("click")},btnStyle:function(a,b){if(a)"set"==b&&($("#comp_"+a+",#recent_"+a).addClass("btn-compare-s-active"),$("#cmp_"+a).text("\u53d6\u6d88\u5bf9\u6bd4")),"del"==b&&($("#comp_"+a+",#recent_"+a).removeClass("btn-compare-s-active"),$("#cmp_"+a).text("\u52a0\u5165\u5bf9\u6bd4"));else{var c=readCookie(this.cookieName)||"";if(c=c.split("."),c.length<5)for(var d=0;d<c.length;d++)"set"==b&&($("#comp_"+c[d]+",#recent_"+c[d]).addClass("btn-compare-s-active"),$("#cmp_"+c[d]).text("\u53d6\u6d88\u5bf9\u6bd4")),"del"==b&&($("#comp_"+c[d]+",#recent_"+c[d]).removeClass("btn-compare-s-active"),$("#cmp_"+c[d]).text("\u52a0\u5165\u5bf9\u6bd4"))}return this},loadExistList:function(a){var b=readCookie(this.cookieName)||"";b=b.split(".");for(var c=0;c<b.length;c++)c+1==b.length?this.setContrastItem(b[c],a):this.setContrastItem(b[c])},showPopWin:function(a){var d=($("#pop-compare"),this);return a=a||null,$("#pop-compare").length<1&&($("body").append(this.TPL.contrast),$("#diff-items").delegate(".del-comp-item","click",function(){var a=$(this).attr("skuid");return d.delContrastItem(a),!1})),d.hasCookie(a)||0!=$("#diff-items .item-empty").length?($("#diff-items .hasItem").length<1&&(readCookie(this.cookieName)?this.loadExistList(function(){d.hasCookie(a)?d.delContrastItem(a):d.setContrastItem(a)}):d.setContrastItem(a)),"false"==$("#pop-compare").attr("data-load")?($("#pop-compare").show().attr("data-load","true"),$("#pop-compare").Jtab({currClass:"current",compatible:!0,event:"click"},function(a,b,c){1==c&&$(".scroll-loading").length>0&&d.setRecent(function(a){d.setRecentScroll(),d.getPriceNum(a,$("#pop-compare"),null,function(){})})}),6!==g&&$("#pop-compare").animate({bottom:0},100)):("side"==readCookie(d.cookieName+"_status")&&($("#pop-compare").show().attr("data-load","true"),6!==g&&$("#pop-compare").show().animate({bottom:0}),createCookie(d.cookieName+"_status","show",30,"/;domain="+this.domain)),d.hasCookie(a)?d.delContrastItem(a):d.setContrastItem(a)),void d.bindEvent("delAll").bindEvent("hide")):(d.setMessage("\u5bf9\u6bd4\u680f\u5df2\u6ee1\uff0c\u60a8\u53ef\u4ee5\u5220\u9664\u4e0d\u9700\u8981\u7684\u680f\u5185\u5546\u54c1\u518d\u7ee7\u7eed\u6dfb\u52a0\u54e6\uff01"),!1)},hidePopWin:function(){var a=this;if(6==g)$("#pop-compare").hide();else{if($(".pop-wrap").is(":animated"))return!1;$("#pop-compare").css("overflow","hidden").find(".pop-wrap").animate({left:"990px"},100,function(){$("#pop-compare").removeAttr("style").css({overflow:"visible",bottom:"-200px"}).hide().find(".pop-wrap").removeAttr("style").css("left",0)})}a.bindEvent("showWin"),createCookie(a.cookieName+"_status","side",30,"/;domain="+this.domain)},setContrastItem:function(a,b){var c=$("#pop-compare"),d=readCookie(this.cookieName)||"",f=(d.split(".").length,this);if(f.hasCookie(a)&&"true"==c.attr("data-load"))f.delContrastItem(a);else{if(!a)return!1;$.ajax({url:"http://d.jd.com/ware/history?ids="+a,dataType:"jsonp",success:function(d){var e=$("#diff-items dl").index($("#diff-items").find(".item-empty").eq(0));var d=d[a];d.url="http://item.jd.com/"+a+".html",d.imagePath=encodeURI(pageConfig.FN_GetImageDomain(a)+"n5/"+d.imagePath),d.name=encodeURI(d.name),d.skuid=a,d.ind=e,($("#cmp_item_"+a).length<1||!f.hasCookie(a))&&(c.find(".item-empty").eq(0).replaceWith(f.TPL.item.process(d)),f.getPriceNum(a,$("#pop-compare"),null,function(){})),f.bindEvent("delHover").setCookie(a).btnStyle(a,"set"),createCookie(f.cookieName+"_status","show",30,"/;domain="+f.domain),"function"==typeof b&&b(),f.setContrastBtn("add"),$("#pop-compare").attr("data-load","true")}})}return this},setContrastBtn:function(a){var b=readCookie(this.cookieName)||"",c=b.split(".").length;"add"==a&&c>1&&$("#goto-contrast").addClass("compare-active"),"reduce"==a&&2>c&&$("#goto-contrast").removeClass("compare-active")},sortList:function(){var a=$("#diff-items"),b=a.find(".hasItem").length;a.find(".item-empty").remove();for(var c=b;4>c;c++)$("#diff-items").append('<dl class="item-empty"><dt>'+(c+1)+"</dt><dd>\u60a8\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u6dfb\u52a0</dd></dl>");return this.bindEvent("delHover"),this},delContrastItem:function(a,b){if(b){$("#diff-items").html("");for(var c=1;5>c;c++)$("#diff-items").append('<dl class="item-empty"><dt>'+c+"</dt><dd>\u60a8\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u6dfb\u52a0</dd></dl>");this.btnStyle(null,"del"),$("#goto-contrast").removeClass("compare-active"),$(".btn-compare").removeClass("btn-compare-s-active"),$("#goto-contrast").unbind("click"),createCookie(this.cookieName,"",-1,"/;domain="+this.domain)}else $("#cmp_item_"+a).remove(),this.sortList().delCookie(a).btnStyle(a,"del"),this.setContrastBtn("reduce");return this},delCookie:function(a){if(this.hasCookie(a)&&null!==a){var b=readCookie(this.cookieName);var c=b.replace(new RegExp(a+".|."+a+"|"+a),"");createCookie(this.cookieName,c,0,"/;domain="+this.domain)}return this},setCookie:function(a){var b=readCookie(this.cookieName)||"";return skuArr=b.split("."),!this.hasCookie(a)&&skuArr.length<4&&(b?(skuArr.push(a),createCookie(this.cookieName,skuArr.join("."),1,"/;domain="+this.domain)):createCookie(this.cookieName,a,1,"/;domain="+this.domain)),this},hasCookie:function(a){return a?new RegExp(a).test(readCookie(this.cookieName)):void 0},setRecentScroll:function(){var a=this;$(".scroll-con").imgScroll({visible:4,speed:300,step:1,loop:!1,direction:"x",evtType:"click",next:".sb-next",prev:".sb-prev",disableClass:"disabled"}),a.bindEvent("cmpBtn")},getRecent:function(){var c=this;new e({$el:$("#scroll-con-inner"),skuHooks:"SKUS_recent_view",param:{p:202001,sku:"",ck:"pin,ipLocation,atw,aview",lim:50},callback:function(a,b){var b=b.data;var d=b.length;var e="";if(a)for(var f=0;d>f;f++)b[f].img=encodeURI(pageConfig.FN_GetImageDomain(b[f].sku)+"n7/"+b[f].img),b[f].url="http://item.jd.com/"+b[f].sku+".html",e+=c.TPL.recentItem.process(b[f]);$("#scroll-con-inner").html(e),c.setRecentScroll()}})},setRecent:function(){this.getRecent()},setMessage:function(a){$(".pop-compare-tips").text(a).fadeIn(),setTimeout(function(){$(".pop-compare-tips").fadeOut()},8e3)}};var i=function(a,b){a=a||"_contrast",b=b||"list",status=readCookie(a+"_status");var c=null;"show"!=status&&"side"!=status||1!=!!readCookie(a)||(c?c.showPopWin(null):c=h.init(b,a)),$(".btn-compare").live("click",function(){var d=$(this).attr("skuid");return 0==$(this).closest("#pop-compare").length&&(c?c.showPopWin(d):c=h.init(b,a,d)),!1})};return i});
