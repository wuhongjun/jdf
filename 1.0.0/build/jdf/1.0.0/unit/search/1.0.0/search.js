/* jdf-1.0.0/ search.js Date:2015-05-28 17:24:12 */
var searchlog=function(){var a="http://sstat."+pageConfig.FN_getDomain()+"/scslog?args=";var b="{keyword}^#psort#^#page#^#cid#^"+encodeURIComponent(document.referrer);var c="2";var d="";var e="";var f=function(){var f="";var g="";var h="";var i="0";if(arguments.length>0)if(0==arguments[0])f=a+c+"^"+b+"^^^58^^"+e+"^"+d;else if(1==arguments[0]){f=10!=c?a+"1^"+b+"^":a+"11^"+b+"^";for(var j=1;j<arguments.length;j++)f+=encodeURI(arguments[j])+"^";arguments.length>3&&"51"==arguments[3]&&(g=arguments[1]),arguments.length>3&&"55"==arguments[3]&&(h=arguments[1]),arguments.length>3&&"56"==arguments[3]&&(i=arguments[1]);for(var j=0,k=5-arguments.length;k>j;j++)f+="^";f+=e+"^"+d}f=f.replace("#cid#",g),f=f.replace("#psort#",h),f=f.replace("#page#",i),$.getScript(f)};return f}();function search(a){var b="http://search.jd.com/Search?keyword={keyword}&enc={enc}{additional}";var c=search.additinal||"";var d=document.getElementById(a);var e=d.value;if(e=e.replace(/^\s*(.*?)\s*$/,"$1"),e.length>100&&(e=e.substring(0,100)),""==e)return void(window.location.href=window.location.href);var f=0;"undefined"!=typeof window.pageConfig&&"undefined"!=typeof window.pageConfig.searchType&&(f=window.pageConfig.searchType);var g="&cid{level}={cid}";var h="string"==typeof search.cid?search.cid:"";var i="string"==typeof search.cLevel?search.cLevel:"";var j="string"==typeof search.ev_val?search.ev_val:"";switch(f){case 0:break;case 1:i="-1",c+="&book=y";break;case 2:i="-1",c+="&mvd=music";break;case 3:i="-1",c+="&mvd=movie";break;case 4:i="-1",c+="&mvd=education";break;case 5:var k="&other_filters=%3Bcid1%2CL{cid1}M{cid1}[cid2]";switch(i){case"51":g=k.replace(/\[cid2]/,""),g=g.replace(/\{cid1}/g,"5272");break;case"52":g=k.replace(/\{cid1}/g,"5272"),g=g.replace(/\[cid2]/,"%3Bcid2%2CL{cid}M{cid}");break;case"61":g=k.replace(/\[cid2]/,""),g=g.replace(/\{cid1}/g,"5273");break;case"62":g=k.replace(/\{cid1}/g,"5273"),g=g.replace(/\[cid2]/,"%3Bcid2%2CL{cid}M{cid}");break;case"71":g=k.replace(/\[cid2]/,""),g=g.replace(/\{cid1}/g,"5274");break;case"72":g=k.replace(/\{cid1}/g,"5274"),g=g.replace(/\[cid2]/,"%3Bcid2%2CL{cid}M{cid}");break;case"81":g=k.replace(/\[cid2]/,""),g=g.replace(/\{cid1}/g,"5275");break;case"82":g=k.replace(/\{cid1}/g,"5275"),g=g.replace(/\[cid2]/,"%3Bcid2%2CL{cid}M{cid}")}b="http://search.e.jd.com/searchDigitalBook?ajaxSearch=0&enc=utf-8&key={keyword}&page=1{additional}";break;case 6:i="-1",b="http://music.jd.com/8_0_desc_0_0_1_15.html?key={keyword}";break;case 7:b="http://s.e.jd.com/Search?key={keyword}&enc=utf-8"}if("string"==typeof h&&""!=h&&"string"==typeof i){var l=/^(?:[1-8])?([1-3])$/;i="-1"==i?"":l.test(i)?RegExp.$1:"";var m=g.replace(/\{level}/,i);m=m.replace(/\{cid}/g,h),c+=m}if("string"==typeof j&&""!=j&&(c+="&ev="+j),"undefined"!=typeof $o.click&&$o.click!==!1&&"undefined"!=typeof $o.lastKeyword&&$o.lastKeyword!==!1)try{JA.tracker.ngloader("search.000002",{prefix:$o.lastKeyword,keyword:e,pos:$o.click})}catch(n){}e=encodeURIComponent(e),sUrl=b.replace(/\{keyword}/,e),sUrl=sUrl.replace(/\{enc}/,"utf-8"),sUrl=sUrl.replace(/\{additional}/,c),("undefined"==typeof search.isSubmitted||0==search.isSubmitted)&&(setTimeout(function(){window.location.href=sUrl},10),search.isSubmitted=!0)}var $o=function(){var a={};a.replace=function(a,b){return a.replace(/#{(.*?)}/g,function(){var a=arguments[1];return"undefined"!=typeof b[a]?b[a]:arguments[0]})},String.prototype.isEmpty=function(){return 0==this.length};var b='<a style="color:#005AA0" onclick="$o.del(event)">\u5220\u9664</a>';var c="\u641c\u7d22\u5386\u53f2",d="\u7ea6#{amount}\u4e2a\u5546\u54c1",e='history="1"',f='style="color:#005AA0"';var g='<li id="d_#{id}" suggest-pos="#{suggest_pos}" title="#{title}" onclick="$o.clickItem(this)" #{history_mark}><div class="search-item" #{history_style}>#{keyword}</div><div class="search-count">#{search_count}</div></li>';var h='<div id="d_#{id}" suggest-pos="#{suggest_pos}" class="#{className}" title="#{title}" cid="#{cid}" cLevel="#{cLevel}" onclick="$o.clickItem(this)"><div class="search-item">\u5728<strong>#{cname}</strong>\u5206\u7c7b\u4e2d\u641c\u7d22</div><div class="search-count">\u7ea6#{amount}\u4e2a\u5546\u54c1</div></div>';var i='<div id="d_#{id}" suggest-pos="#{suggest_pos}" class="#{className}" title="#{title}" pm_type="#{pm_type}" onclick="$o.clickItem(this)"><div class="search-item">\u627e<strong>#{cname}</strong>\u76f8\u5173\u4f18\u60e0</div><div class="search-count"></div></div>';var j='<li class="fore1"><div id="d_#{id}" suggest-pos="#{suggest_pos}" class="fore1" title="#{title}" onclick="$o.clickItem(this)" #{history_mark}><div class="search-item" #{history_style}>#{keyword}</div><div class="search-count">#{search_count}</div></div>#{categorys}</li>';var k="http://dd.search.jd.com/?ver=2&zip=1&key=#{keyword}";var l="#FFDFC6";var m="#FFF";var n=$("#key");var o=$("#shelper");function p(){this.length=0,this.index=-1,this.iLastModified=0,this.lastKeyword=!1}p.prototype.init=function(){this.length=0,this.index=-1,this.click=!1},p.prototype.hideTip=function(){this.init(),this.lastKeyword=!1,o.html("").hide()},p.prototype.clickItem=function(a){var b=a.getAttribute("cid"),c="&suggest="+a.getAttribute("suggest-pos");search.cid=null!=b&&""!=b?b:null;var d=a.getAttribute("cLevel");search.cLevel=null!=d&&""!=d?d:null;var e=a.getAttribute("title");null==e||$.trim(e).isEmpty()||n.val(e),null!==a.getAttribute("pm_type")&&(c+="&prom_type=0"),search.additinal=c,this.click=a.id.substr(2)-o.find("li[history='1']").length,search("key")},p.prototype.mouseenter=function(a){var a=$(a);a.attr("history")&&a.find(".search-count").html(b),a.css("background",l);var d=a.attr("id").split("_"),e=parseInt(d[1],10);if(e!=this.index){if(this.index>-1){var f=$("#d_"+this.index);f.css("background",m),f.attr("history")&&f.find(".search-count").html(c)}this.index=e}},p.prototype.mouseleave=function(a){a.css("background",m),a.attr("history")&&a.find(".search-count").html(c)},p.prototype.selectItemNode=function(a){var d=this;var e=$("#d_"+d.index+":visible");e.css("background-color",m),e.attr("history")&&e.find(".search-count").html(c),-1==d.index&&-1==a&&(a=0),d.index=(d.length+d.index+a)%d.length;var f=$("#d_"+d.index),g="&suggest="+f.attr("suggest-pos");if(f.length>0){f.attr("history")&&f.find(".search-count").html(b),f.css("background-color",l);var h=f.attr("title");null==h||$.trim(h).isEmpty()||n.val(h);var i=f.attr("cid");search.cid=null!=i&&""!=i?i:null;var j=f.attr("cLevel");search.cLevel=null!=j&&""!=j?j:null,"undefined"!=typeof f.attr("pm_type")&&(g+="&prom_type=0"),search.additinal=g,d.click=d.index-o.find("li[history='1']").length}},p.prototype.input=function(){var b=this;b.timeoutId&&clearTimeout(b.timeoutId),b.timeoutId=setTimeout(function(){var c=$.trim(n.val());if(c===b.lastKeyword||!(c||readCookie("pin")||readCookie("_tp")))return!1;b.lastKeyword=c;var d=a.replace(k,{keyword:encodeURIComponent(c)});$.ajax({url:d,dataType:"jsonp",scriptCharset:"utf-8",jsonp:"callback",success:function(a){return function(c){b.iLastModified>a||(b.iLastModified=a,c&&b.onloadItems(c))}}((new Date).getTime())})},150)},p.prototype.keydown_up=function(a){var b=this;var c=a||window.event;0==n.length&&(n=$("#key")),0==o.length&&(o=$("tie"));var d=c.keyCode;switch(d){case 38:b.selectItemNode(-1);break;case 40:b.selectItemNode(1);break;case 27:b.hideTip();break;case 37:break;case 39:break;default:$.browser.mozilla||b.input()}},p.prototype.onloadItems=function(b){if(0==b.length)return void this.hideTip();var k=this;k.init();var l="";var m=0;window.pageConfig&&window.pageConfig.searchType&&(m=window.pageConfig.searchType);var p=0,l="";var q=0,r=$.trim(n.val());for(var s=0,t=b.length;t>s;s++){var u=b[s];if(u){var v=$.trim(u.key),w=u.his?c:a.replace(d,{amount:u.qre}),x=u.his?e:"",y=u.his?f:"";var z=v.toLowerCase().indexOf(r.toLowerCase());var A=v;if(r.length&&0==z&&!u.his&&(A=r+"<strong>"+v.substring(z+r.length)+"</strong>"),u.ci&&u.ci.length>0){var B="",C=q++;0==s&&k.show_prompt()&&u.act&&(B+=a.replace(i,{id:q,title:v,pm_type:0,className:"item1",cname:v,suggest_pos:p}),q++);for(var D=0,E=u.ci.length;E>D;D++){var F=u.ci[D].cid;if(0==m){if("string"==typeof F&&/^[1-8]4$/.test(F))continue}else if(5==m){if("string"==typeof F&&!/^[5-8]2$/.test(F))continue}else if(1==m||2==m||3==m||4==m)continue;B+=a.replace(h,{id:q,title:v,cid:F,cLevel:u.ci[D].cle,className:"item1",cname:u.ci[D].cna,amount:u.ci[D].cre,suggest_pos:p}),q++}l+=a.replace(j,{id:C,title:v,keyword:A,suggest_pos:p,categorys:B,search_count:w,history_mark:x,history_style:y}),p++}else l+=a.replace(g,{id:q,title:v,keyword:A,suggest_pos:p,search_count:w,history_mark:x,history_style:y}),q++,p++}}k.length=q,""!=l?(l+='<li class="close" onclick="$o.hideTip()">\u5173\u95ed</li>',o.html(l).show(),o.find('[id^="d_"]').bind("mouseleave",function(){k.mouseleave($(this))}).bind("mouseenter",function(){k.mouseenter($(this))})):o.html("").hide()},p.prototype.show_prompt=function(){var a=0;return window.pageConfig&&window.pageConfig.searchType&&(a=1*window.pageConfig.searchType),a&&1!=a?!1:!0},p.prototype.bind_input=function(){$.browser.mozilla?(n.bind("keydown",function(a){q.keydown_up(a)}),n.bind("input",function(a){q.input(a)})):n.bind("keyup",function(a){q.keydown_up(a)}),n.focus(function(){setTimeout(function(){q.input()},10)}),o.parent().bind("mouseenter",function(){q.e_position=!0,q.timeoutId&&clearTimeout(q.timeoutId)}).bind("mouseleave",function(){q.e_position=!1,q.timeoutId=setTimeout(function(){q.hideTip()},500)}),$(document).click(function(){q.e_position||q.hideTip()})},p.prototype.del=function(a){var b=this;a=a?a:window.event,window.event?(a.cancelBubble=!0,a.returnValue=!1):(a.stopPropagation(),a.preventDefault());var c=$(a.srcElement?a.srcElement:a.target),d=c.parent().parent().attr("title");$.ajax({url:"http://search.jd.com/suggest.php?op=del&callback=?&key="+encodeURIComponent(d),dataType:"jsonp",scriptCharset:"utf-8",beforeSend:function(){c.parents("li").hide()},success:function(){b.lastKeyword=!1,n.focus()}})};var q=new p;return q.bind_input(),q}();
